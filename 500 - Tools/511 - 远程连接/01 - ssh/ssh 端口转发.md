## SSH 端口转发 ^[1]^

### 本地端口转发
#### 背景/效果/应用场景
通过 ssh 连接远程主机未开放的端口
> 一般来讲，云主机的防火墙默认只打开了22端口，如果需要访问3000端口的话，需要修改防火墙。为了保证安全，防火墙需要配置允许访问的IP地址。但是，本地公网IP通常是网络提供商动态分配的，是不断变化的。这样的话，防火墙配置需要经常修改，就会很麻烦。

> 所谓本地端口转发，就是将发送到本地端口的请求，转发到目标端口。这样，就可以通过访问本地端口，来访问目标端口的服务。

#### 语法
```shell
ssh -L 本地网卡地址:本地端口:目标地址:目标端口 user@host
```

#### 示例
```shell
# 在本地主机A1登陆远程云主机B1，并进行本地端口转发
ssh -L localhost:2000:remote:3000 root@103.59.22.17
```
这样，在本地主机上可以通过访问 http://localhost:2000 来访问远程云主机上 3000 端口的服务

#### 注意
1. -L 选项中的 `本地网卡地址` 可以省略
2. -L 选项中的目标地址可以是其他主机，不必是 ssh 连接的目标主机

### 远程端口转发

#### 背景/效果/应用场景
> 本地主机A1运行了一个服务，端口为3000，远程云主机B1需要访问这个服务。

> 通常，本地主机是没有独立的公网IP的，它与同一网络中的主机共享一个IP。没有公网IP，云主机是无法访问本地主机上的服务的

> 所谓远程端口转发，就是将发送到远程端口的请求，转发到目标端口。这样，就可以通过访问远程端口，来访问目标端口的服务

#### 语法
```shell
ssh -R 远程网卡地址:远程端口:本地目标地址:本地目标端口 user@host
```

#### 例子
```shell
# 在本地主机A1登陆远程云主机B1，并进行远程端口转发
ssh -R remote:2000:localhost:3000 root@103.59.22.17
```
这时，通过远程端口转发，可以将发送到远程云主机端口 2000 的请求，转发到本地主机端口 3000

#### 注意
1. 远程网卡地址可以省略
2. 目标地址可以是其他主机地址

### 动态端口转发
- [ ] TODO :smile:

## 参考
1. [玩转SSH端口转发](https://blog.fundebug.com/2017/04/24/ssh-port-forwarding/)